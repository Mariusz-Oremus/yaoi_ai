<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show Details</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
    <h1>Show Details</h1>

    <form id="show-edit-form">
        <label for="show-title">Title:</label>
        <input type="text" id="show-title" name="title" required><br><br>

        <label for="show-author">Author:</label>
        <input type="text" id="show-author" name="author" required><br><br>

        <label for="show-director">Director:</label>
        <input type="text" id="show-director" name="director" required><br><br>

        <label for="show-genre">Genre:</label>
        <input type="text" id="show-genre" name="genre" required><br><br>

        <label for="show-year">Year:</label>
        <input type="number" id="show-year" name="year" required><br><br>

        <label for="show-description">Description:</label><br>
        <textarea id="show-description" name="description" rows="4" required></textarea><br><br>

        <button type="button" id="save-show">Save Changes</button>
        <button type="button" id="back-button">Back</button> 
        <br>
        <button type="button" id="delete-show">Delete Show</button>
    </form>

    <script type="module" src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDeQiMJRp_Yg-WdT6hF1aQsDfg45rxn9uc",
            authDomain: "yaoi-ai-2f819.firebaseapp.com",
            projectId: "yaoi-ai-2f819",
            storageBucket: "yaoi-ai-2f819.firebasestorage.app",
            messagingSenderId: "296158977150",
            appId: "1:296158977150:web:461f7576296897776c4c2f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const urlParams = new URLSearchParams(window.location.search);
        const showId = urlParams.get('id'); // Get the show ID from the URL

        async function fetchShowData() {
            const showDoc = await getDoc(doc(db, "shows", showId));
            if (showDoc.exists()) {
                const showData = showDoc.data();
                document.getElementById("show-title").value = showData.title;
                document.getElementById("show-author").value = showData.author;
                document.getElementById("show-director").value = showData.director;
                document.getElementById("show-genre").value = showData.genre;
                document.getElementById("show-year").value = showData.year;
                document.getElementById("show-description").value = showData.description;
            } else {
                alert("Show not found!");
            }
        }

        fetchShowData();

        document.getElementById("save-show").addEventListener("click", async () => {
            const updatedShow = {
                title: document.getElementById("show-title").value,
                author: document.getElementById("show-author").value,
                director: document.getElementById("show-director").value,
                genre: document.getElementById("show-genre").value,
                year: document.getElementById("show-year").value,
                description: document.getElementById("show-description").value
            };
            await updateDoc(doc(db, "shows", showId), updatedShow);
        });

        document.getElementById("delete-show").addEventListener("click", async () => {
            await deleteDoc(doc(db, "shows", showId));
            window.location.href = "../show.html"; // Redirect back to the main show list
        });

        document.getElementById("back-button").addEventListener("click", () => {
            window.location.href = "../show.html"; // Go back to show.html
        });
    </script>
</body>
</html>